import{d as E,r as i,k as B,a as N,c as a,b as l,F as p,f as y,l as m,g as f,m as T,v as M,n as w,t as r,h as C,e as g,i as n,_ as L}from"./index-CDbN5wV1.js";import{f as F}from"./dateFormatter-CkW-UK-w.js";const O={class:"admin-panel"},P={class:"sidebar"},z=["onClick"],q={class:"sidebar__btn-wrapper"},G=["onClick"],H={class:"main"},J={class:"filters"},K=["value"],Q=["value"],R={key:0,class:"empty"},W={key:1,class:"messages"},X={class:"meta"},Y={class:"role"},Z={class:"type"},ee={class:"date"},te={class:"content"},le=E({__name:"AdminPanel",setup(se){const d=i([]),u=i([]),c=i(null),k=i(localStorage.getItem("session_id")),_={user:"ゲスト",assistant:"AI アシスタント"},b={job:"仕事",study:"学業",relationship:"人間関係",health:"健康"},o=i({role:"",type:"",dateFrom:"",dateTo:""}),D=()=>{o.value={role:"",type:"",dateFrom:"",dateTo:""}},S=async s=>{if(confirm("このセッションを削除しますか?"))try{await fetch(`http://3.90.2.57:8000/sessions/${s}`,{method:"DELETE"}),d.value=d.value.filter(e=>e.id!==s),c.value===s&&(c.value=null,u.value=[])}catch(e){console.error("削除エラー",e)}},x=s=>{S(s)},V=async()=>{if(u.value.length===0)return;const s=u.value.map(e=>`[${e.role.toUpperCase()}] ${e.content}`).join(`

`);try{await navigator.clipboard.writeText(s),alert("✅ コピーしました")}catch(e){alert("❌ コピー失敗しました"),console.error(e)}},j=async()=>{try{const s=await fetch("http://3.90.2.57:8000/sessions");d.value=await s.json()}catch(s){console.log(s)}},I=B(()=>u.value.filter(s=>{var h;const e=!o.value.role||s.role.includes(o.value.role),t=!o.value.type||((h=s.type)==null?void 0:h.includes(o.value.type)),v=new Date(s.date),$=!o.value.dateFrom||v>=new Date(o.value.dateFrom),A=!o.value.dateTo||v<=new Date(o.value.dateTo+"T23:59:59");return e&&t&&$&&A})),U=async s=>{try{c.value=s,u.value=d.value.filter(e=>e.id===s)[0].messages}catch(e){console.error(e)}};return N(j),(s,e)=>(n(),a("div",O,[l("div",P,[e[4]||(e[4]=l("h2",null,"セッション",-1)),l("ul",null,[(n(!0),a(p,null,y(d.value,t=>(n(),a("li",{key:t.id,class:w({active:t.id===c.value}),onClick:v=>U(t.id)},[l("span",null,r(t.id.slice(0,8))+" • "+r(C(F)(t.created_at)),1),l("div",q,[t.id===k.value?(n(),a("button",{key:0,onClick:v=>x(t.id),class:"delete-btn"}," 🗑 ",8,G)):g("",!0),t.id===k.value?(n(),a("button",{key:1,onClick:V,class:"copy-button"}," 📄 ")):g("",!0)])],10,z))),128))])]),l("div",H,[e[11]||(e[11]=l("h2",null,"メッセージ履歴",-1)),l("div",J,[l("label",null,[e[6]||(e[6]=m(" 役割: ")),f(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.role=t)},[e[5]||(e[5]=l("option",{value:"",disabled:"",selected:""},"選択",-1)),(n(!0),a(p,null,y(Object.keys(_),t=>(n(),a("option",{key:t,value:t},r(_[t]),9,K))),128))],512),[[T,o.value.role]])]),l("label",null,[e[8]||(e[8]=m(" タイプ: ")),f(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.type=t)},[e[7]||(e[7]=l("option",{value:"",disabled:"",selected:""},"選択",-1)),(n(!0),a(p,null,y(Object.keys(b),t=>(n(),a("option",{value:t,key:t},r(b[t]),9,Q))),128))],512),[[T,o.value.type]])]),l("label",null,[e[9]||(e[9]=m(" 開始日: ")),f(l("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.dateFrom=t)},null,512),[[M,o.value.dateFrom]])]),l("label",null,[e[10]||(e[10]=m(" 日付順: ")),f(l("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.dateTo=t)},null,512),[[M,o.value.dateTo]])]),l("button",{onClick:D},"リセット")]),u.value.length===0?(n(),a("div",R,"セッションを選択")):(n(),a("div",W,[(n(!0),a(p,null,y(I.value,t=>(n(),a("div",{key:t.id,class:w(["message",[t.role==="user"?"user-message":""]])},[l("div",X,[l("span",Y,r(_[t.role]),1),l("span",Z,r(b[t.type]),1),l("span",ee,r(C(F)(t.date)),1)]),l("div",te,r(t.content),1)],2))),128))]))])]))}}),ne=L(le,[["__scopeId","data-v-89864585"]]);export{ne as default};
