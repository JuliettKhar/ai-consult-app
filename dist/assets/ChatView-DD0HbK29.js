import{d as j,r as i,o as V,a as A,c as l,b as s,e as g,F as P,f as B,w as O,g as F,v as J,u as N,n as D,t as y,h as R,i as u,_ as $}from"./index-Lg29s3p5.js";import{f as E}from"./dateFormatter-CkW-UK-w.js";const z={temperature:.5,top_p:.9,frequency_penalty:.6,presence_penalty:.3,max_tokens:1024},L={temperature:.6,top_p:1,frequency_penalty:.5,presence_penalty:.4,max_tokens:1024},Q={temperature:.7,top_p:1,frequency_penalty:.7,presence_penalty:.6,max_tokens:1200},U={temperature:.5,top_p:.95,frequency_penalty:.4,presence_penalty:.2,max_tokens:1024},W="あなたはキャリアアドバイザーです。ユーザーの入力を元に、仕事・職場での悩みに対して実践的かつ丁寧なアドバイスを提供してください。言語はユーザーの入力に合わせてください。",X="あなたは教育カウンセラーです。学業・勉強・進路に関する悩みに対して、親切で前向きなアドバイスを提供してください。ユーザーの使用言語を自動的に判断して返答してください。",Y="あなたは信頼できる相談相手です。人間関係やコミュニケーションに関する悩みに対して、優しく共感しながら、役に立つアドバイスを提供してください。ユーザーの言語に応じて返答してください。",Z="あなたは健康・メンタルサポートに関するアドバイザーです。ユーザーの体調や心の悩みに対して、無理のない、思いやりのあるアドバイスを行ってください。必要に応じて専門機関への相談も勧めてください。入力言語に合わせて返答してください。",G="あなたは優しく丁寧なカウンセラーとして相談に答えます。ユーザーの使用言語を自動的に判断して返答してください。",H="あなたは優しく丁寧なカウンセラーとして相談に答えます。",K={class:"chat-view"},ee={class:"chat-view__wrapper"},te={class:"chat-view__window",id:"chatWindow"},se={key:0,class:"chat-message welcome-message"},ae=["id"],oe={class:"bot-title"},ne={class:"bot-label"},re={key:1,class:"typing-indicator"},ce={class:"chat-view__form-wrapper"},ie={class:"chat-view__textarea"},le=j({__name:"ChatView",setup(ue){const n=N(),p=i(""),a=i([{role:"system",content:H}]),d=i(null),_=i(!1),r=i(null),h=i([]),C=e=>{switch(e){case"job":return W;case"study":return X;case"relationship":return Y;case"health":return Z;default:return G}},x=e=>{switch(e){case"job":return z;case"study":return L;case"relationship":return Q;case"health":return U;default:return{temperature:.7}}},I=e=>{const t=a.value.slice(1);return[{role:"system",content:C(e)},...h.value,...t]},v=()=>{setTimeout(()=>{const e=document.getElementById(`message-${a.value.length-1}`);e==null||e.scrollIntoView({behavior:"smooth"})},0)},f=()=>sessionStorage.getItem("apiKey")||null,T=()=>{const e=[];return e.push(...a.value.slice(0,1)),h.value.length>0&&e.push(...h.value),a.value.length>1&&e.push(...a.value.slice(1)),e.filter(t=>t.type===n.query.type)},b=async()=>{var e,t,o,c;try{_.value=!0;const k=await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d.value}`},body:JSON.stringify({model:"gpt-4",messages:I(((e=n.query)==null?void 0:e.type)||""),...x(((t=n.query)==null?void 0:t.type)||"")})})).json();a.value.push({role:"assistant",content:k.choices[0].message.content}),w({...k.choices[0].message,role:"assistant",type:(o=n.query)==null?void 0:o.type,session_id:r.value})}catch(m){a.value.push({role:"assistant",content:m==null?void 0:m.message,type:(c=n.query)==null?void 0:c.type})}finally{_.value=!1}},w=async e=>{try{await fetch("http://3.90.2.57:8000/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,session_id:r.value})})}catch(t){console.log(t)}},S=async()=>{try{const e=new URLSearchParams;r.value&&e.append("session_id",r.value);const t=await fetch(`https://3.90.2.57.nip.io/messages?${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});h.value=await t.json()}catch(e){console.log(e)}},q=async()=>{var e;if(!d.value){d.value=f(),d.value||alert("API key is required");return}if(p.value){const t={role:"user",content:p.value,type:(e=n.query)==null?void 0:e.type,session_id:r.value};a.value.push(t),v(),w(t),p.value=""}else return;try{await b(),v()}catch(t){console.error(t)}},M=async()=>{try{let e=localStorage.getItem("session_id");return e||(e=(await(await fetch("https://3.90.2.57.nip.io/sessions",{method:"POST"})).json()).id,localStorage.setItem("session_id",e)),e}catch(e){return console.error(e),null}};return V(async()=>{d.value=f()}),A(async()=>{r.value=await M(),await S(),a.value=T(),v()}),(e,t)=>(u(),l("div",K,[s("section",ee,[s("div",te,[a.value.length===1?(u(),l("div",se," こんにちは！ご相談内容を教えてください。 ")):g("",!0),(u(!0),l(P,null,B(a.value,(o,c)=>(u(),l(P,{key:c},[c>0?(u(),l("div",{key:0,class:D(["chat-message bot",o.role==="assistant"?"assistant":"user"]),id:`message-${c}`},[s("span",oe,[s("span",null,y(o.role==="assistant"?"🤖":"👤"),1),s("span",ne,y(o.role==="assistant"?"AI アシスタント":"あなた (ゲスト)"),1),s("span",null,y(R(E)(o.date)),1)]),s("p",null,y(o.content),1)],10,ae)):g("",!0)],64))),128)),_.value?(u(),l("p",re,"考え...")):g("",!0)]),s("div",ce,[s("form",{id:"chatForm",class:"chat-view__form",onClick:t[1]||(t[1]=O(()=>{},["prevent"]))},[s("div",ie,[F(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),rows:"4",cols:"30",type:"text",id:"userInput",name:"userInput",placeholder:"メッセージを入力...",required:""},null,512),[[J,p.value,void 0,{trim:!0}]])]),s("button",{type:"submit",onClick:q},"送信")])])])]))}}),he=$(le,[["__scopeId","data-v-ed614c51"]]);export{he as default};
